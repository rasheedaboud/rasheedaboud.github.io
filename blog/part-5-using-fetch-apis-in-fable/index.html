<!DOCTYPE html>
    <html data-theme="light" lang="en">
      <head>
        <link rel="stylesheet" type="text/css" href="/assets/static/onRenderClient.l0r0DFKJ.css">
        <meta charset="UTF-8" />
        <meta name="google-site-verification" content="tasigl22802n6H-QTcOM1o96ZEKow4vzIU36DCZwO4g" />
        <meta http-equiv='cache-control' content='no-cache'> 
        <meta http-equiv='expires' content='0'> 
        <meta http-equiv='pragma' content='no-cache'>
        <link rel="icon" href="/assets/static/favicon.D7K9RfVp.ico" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="Explore data fetching in F# web apps using Feliz and Fable by integrating the Fetch API with promises and React hooks. Learn through a practical example that retrieves user data asynchronously, utilizing the Fable.Fetch library and the Feliz.UseDeferred hook for efficient and type-safe HTTP requests in a functional programming paradigm." />
        <title>Part 5-Using Fetch APIs in Fable</title>
      </head>
      <body>
        <div id="react-root"><main class="min-h-screen"><header><nav class="bg-black"><div class="mx-auto max-w-7xl px-2 sm:px-6 lg:px-1"><div class="relative flex h-16 items-center justify-between"><div class="absolute inset-y-0 left-0 flex items-center sm:hidden"><button type="button" class="relative inline-flex items-center justify-center rounded-md p-2 text-gray-400 hover:bg-gray-700 hover:text-white focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white" aria-controls="mobile-menu" aria-expanded="false"><span class="absolute -inset-0.5"></span><span class="sr-only">Open main menu</span><svg class="block h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path></svg></button></div><div class="flex flex-1 items-center justify-end sm:items-stretch sm:justify-start"><div class="hidden sm:flex flex-shrink-0 items-center"><svg class="me-auto" width="50" height="50" viewBox="-20 -20 100 100"><g id="SvgjsG1201" transform="scale(1.0)" fill="#fff"><path xmlns="http://www.w3.org/2000/svg" d="M2.61,37.02a1.45852,1.45852,0,0,1-.11-.55V4A1.498,1.498,0,0,1,4,2.5H15.77a1.50728,1.50728,0,0,1,1.06.44L27.18,13.29a1.49682,1.49682,0,0,1,0,2.12L5.06,37.53A1.50653,1.50653,0,0,1,2.61,37.02Z"></path><path xmlns="http://www.w3.org/2000/svg" d="M61.5,4V15.77a1.809,1.809,0,0,1-.11.57,1.62577,1.62577,0,0,1-.33.49L50.71,27.18a1.50713,1.50713,0,0,1-2.12,0L26.47,5.06a1.5155,1.5155,0,0,1,.4901-2.45,1.79313,1.79313,0,0,1,.57-.11L60,2.5A1.498,1.498,0,0,1,61.5,4Z"></path><path xmlns="http://www.w3.org/2000/svg" d="M61.39,26.98a1.45841,1.45841,0,0,1,.11.55V60A1.498,1.498,0,0,1,60,61.5H48.23a1.50747,1.50747,0,0,1-1.06-.44L36.82,50.71a1.49678,1.49678,0,0,1,0-2.12L58.94,26.47A1.50658,1.50658,0,0,1,61.39,26.98Z"></path><path xmlns="http://www.w3.org/2000/svg" d="M19.17,30.94,30.94,19.17a1.509,1.509,0,0,1,2.12,0L44.83,30.94a1.50907,1.50907,0,0,1,0,2.12L33.06,44.83a1.51876,1.51876,0,0,1-2.12,0L19.17,33.06A1.50906,1.50906,0,0,1,19.17,30.94Z"></path><path xmlns="http://www.w3.org/2000/svg" d="M37.86,59.45a1.50661,1.50661,0,0,1-1.39,2.05L4,61.5A1.498,1.498,0,0,1,2.5,60V48.23a1.81029,1.81029,0,0,1,.11-.57,1.62669,1.62669,0,0,1,.33-.49L13.29,36.82a1.54761,1.54761,0,0,1,2.12,0L37.53,58.94A1.28931,1.28931,0,0,1,37.86,59.45Z"></path></g></svg></div><div class="sm:ml-6 sm:block"><div class="flex space-x-4"><a href="/" class="text-gray-300 hover:bg-gray-700 hover:text-white rounded-md px-1 py-3 text-lg font-black" aria-current="page">Rasheed Aboud</a></div></div></div><div class="hidden  sm:flex absolute inset-y-0 right-0  items-center pr-2 sm:static sm:inset-auto sm:ml-6 sm:pr-0"><a href="/blogs" class="text-gray-300 hover:bg-gray-700 hover:text-white rounded-md px-3 py-2 text-sm font-black">Blog</a><a href="/about" class="text-gray-300 hover:bg-gray-700 hover:text-white rounded-md px-3 py-2 text-sm font-black">About</a><a href="/contact" class="text-gray-300 hover:bg-gray-700 hover:text-white rounded-md px-3 py-2 text-sm font-black">Contact</a></div></div></div></nav></header><div class="container mx-auto px-4 py-1"><div><div class="min-h-svh sm:px-10 md:px-24 lg:px-48"><article><div style="min-width:100% !important" class="prose"><h1 class="text-2xl font-black text-pretty uppercase my-5 text-center">Part 5-Using Fetch APIs in Fable</h1><div class="grid-rows-3 grid-flow-col"><div class="flex justify-center items-center"> <figure class="max-w-xs px-3 py-2 min-w-xs "><img style="max-width:300px;max-height:300px" src="https://rasheedaboudblogstorage.blob.core.windows.net/blogs/reactdatafetching.webp?sp=r&amp;st=2024-01-06T20:23:08Z&amp;se=2050-01-07T04:23:08Z&amp;spr=https&amp;sv=2022-11-02&amp;sr=b&amp;sig=yx13rMbse%2BA1YoaSm%2FLTSQ8AGoQFSRF5W93Go8XN%2FCQ%3D" alt="Movie"/></figure></div><div class="grid grid-rows-4 grid-flow-col gap-0 align-middle items-center sm:px-10"><div class="avatar placeholder row-span-4 mx-auto"><div class="bg-neutral text-neutral-content rounded-full w-24"><span class="text-3xl">RA</span></div></div><div class="font-bold uppercase mx-5 sm:mx-0">Rasheed Aboud</div><div class="uppercase mx-5 lg:mx-0">6 min<!-- --> read</div><div class="uppercase mx-5 lg:mx-0">2024-1-5</div><div class="hidden md:block mx-5 lg:mx-0"><button class="badge badge-primary badge-lg mx-1">F#</button><button class="badge badge-primary badge-lg mx-1">react</button><button class="badge badge-primary badge-lg mx-1">fable</button><button class="badge badge-primary badge-lg mx-1">feliz</button><button class="badge badge-primary badge-lg mx-1">web development</button></div></div></div><h2>TL;DR</h2>
<p>In this post we expanded our F# web application&#x27;s functionality with Feliz and Fable by exploring asynchronous HTTP requests to pull in live data from an external service. We walked through two methods: using Fable.Fetch along with promises and Fable.Promise for async calls, and using React.useDeferred for deferred data fetching with better loading state management. We created examples to fetch random user data from an API upon loading the page, showcasing loading states and data rendering in our app&#x27;s UI. Both methods were straightforward, enhancing our app with dynamic, real-time content. Next, we&#x27;ll explore how to integrate third-party components into our F# web app.</p>
<h2>Background</h2>
<p>Welcome back to our adventurous journey through the world of web development with F# using Feliz and Fable! In our previous chapters, we&#x27;ve established a sturdy foundation of our F# web application, crafting interactive UI components with state management techniques. But our application isn&#x27;t an isolated island; it needs to communicate with the vast and dynamic world of the internet. It&#x27;s time to broaden our horizons and venture into the realm of asynchronicity and data fetching.</p>
<p>In this post, we&#x27;ll elevate our application&#x27;s capabilities by learning how to reach out to external services using promises and the Fetch API. Our focus will be on how to make asynchronous HTTP requests that breathe life into our app with fresh, live data from various sources. We&#x27;ll examine the practical uses of promises in F#, how to handle responses and potential errors gracefully, and how to integrate these asynchronous patterns within our functional program design.</p>
<p>As we embark on this path, weâ€™ll get a closer look at employing typed HttpClient instances and integrate these with our Elmish components, ensuring type safety and functional clarity across our application. By the end of this guide, you will have the tools to make your F# web applications not only interactive but also connected and data-rich.</p>
<p>Prepare to unlock the full potential of your web applications with F# and Fable!</p>
<h2>The Plan</h2>
<p>For this demonstration, we will load some data from a third party using browser fetch API to get some random data from <a href="https://random-data-api.com/api/v2/users">random-data-api</a>. I will show you two ways of completing the task</p>
<ol>
<li><a href="https://github.com/fable-compiler/fable-fetch">Fable.Fetch</a></li>
<li><a href="https://zaid-ajaj.github.io/Feliz/#/Hooks/UseDeferred">React.useDeferred</a></li>
</ol>
<p>Both are dead simple to use, each having it&#x27;s own pro and cons.</p>
<h2>Prerequisites</h2>
<p>Grab the code form <a href="https://github.com/rasheedaboud/FSharp-Web-Development/tree/main/Part%204%20-State%20Management">Part 4</a>. It should contain all the required bits to get going.</p>
<p>Here is a short list of the requirements to run the app:</p>
<ul>
<li>.Net 8</li>
<li>Node ^18</li>
<li>npm | pnpm | yarn</li>
<li><a href="https://code.visualstudio.com/">Visual Studio Code</a> with <a href="http://ionide.io/">Ionide</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=alfonsogarciacaro.vscode-template-fsharp-highlight">Highlight templates in F#</a></li>
</ul>
<h2>Fable.Fetch</h2>
<p>Lets dive right in and install the required nuget packages.</p>
<pre class="mb-3 relative box-shadow shadow-2xl"><div class="absolute -top-1  right-7 h-10 w-10 m-5"><button class="btn btn-xs btn-active"><span class=""><i class="fa-solid fa-copy"> <!-- -->Copy</i></span></button></div><div style="color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e"><code class="language-console" style="color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>femto install Fable.Fetch ./src
</span>femto install Fable.Promise ./src</code></div></pre>
<p>Next lets create a new F# file called, you got it <code node="[object Object]">FableFetch.fs</code> to hold our example using the fetch api and <code node="[object Object]">Domain.fs</code> where we will create a subtype of the field return by the API we will be using.</p>
<p><code node="[object Object]">Domain.fs</code></p>
<pre class="mb-3 relative box-shadow shadow-2xl"><div class="absolute -top-1  right-7 h-10 w-10 m-5"><button class="btn btn-xs btn-active"><span class=""><i class="fa-solid fa-copy"> <!-- -->Copy</i></span></button></div><div style="color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e"><code class="language-fsharp" style="color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#569CD6">module</span><span> Domain
</span>
<span></span><span class="token" style="color:#569CD6">type</span><span> </span><span class="token" style="color:#4ec9b0">User</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">{</span><span> id</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">int</span><span>
</span><span>    first_name</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">string</span><span>
</span><span>    last_name</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">string</span><span>
</span><span>    email</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">string</span><span> </span><span class="token" style="color:#d4d4d4">}</span></code></div></pre>
<p><code node="[object Object]">FableFetch.fs</code></p>
<pre class="mb-3 relative box-shadow shadow-2xl"><div class="absolute -top-1  right-7 h-10 w-10 m-5"><button class="btn btn-xs btn-active"><span class=""><i class="fa-solid fa-copy"> <!-- -->Copy</i></span></button></div><div style="color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e"><code class="language-fsharp" style="color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#569CD6">module</span><span> FableFetch
</span>
<span></span><span class="token" style="color:#569CD6">open</span><span> Domain
</span><span></span><span class="token" style="color:#569CD6">open</span><span> Feliz
</span><span></span><span class="token" style="color:#569CD6">open</span><span> Feliz</span><span class="token" style="color:#d4d4d4">.</span><span>DaisyUI
</span><span></span><span class="token" style="color:#569CD6">open</span><span> Fetch
</span>
<span></span><span class="token annotation" style="color:#d4d4d4">[&lt;</span><span class="token annotation" style="color:#4ec9b0">ReactComponent</span><span class="token annotation" style="color:#d4d4d4">&gt;]</span><span>
</span><span></span><span class="token" style="color:#569CD6">let</span><span> FetchData </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">let</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span>users</span><span class="token" style="color:#d4d4d4">,</span><span> setUsers</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> React</span><span class="token" style="color:#d4d4d4">.</span><span>useState </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">[</span><span class="token" style="color:#d4d4d4">]</span><span class="token" style="color:#d4d4d4">)</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">let</span><span> loadUsers </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span>
</span><span>    </span><span class="token computation-expression" style="color:#569CD6">promise</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      </span><span class="token" style="color:#569CD6">let!</span><span> response </span><span class="token" style="color:#d4d4d4">=</span><span> fetch </span><span class="token" style="color:#ce9178">&quot;https://random-data-api.com/api/v2/users?size=10&quot;</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span>      </span><span class="token" style="color:#569CD6">if</span><span> response</span><span class="token" style="color:#d4d4d4">.</span><span>Ok </span><span class="token" style="color:#569CD6">then</span><span>
</span><span>        </span><span class="token" style="color:#569CD6">let!</span><span> users </span><span class="token" style="color:#d4d4d4">=</span><span> response</span><span class="token" style="color:#d4d4d4">.</span><span>json</span><span class="token" style="color:#d4d4d4">&lt;</span><span>User list</span><span class="token" style="color:#d4d4d4">&gt;</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>        setUsers </span><span class="token" style="color:#d4d4d4">(</span><span>users</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>    </span><span class="token" style="color:#6a9955">//we need this to make useEffect happy...</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">|&gt;</span><span> Promise</span><span class="token" style="color:#d4d4d4">.</span><span>start
</span>
<!-- -->
<span>  React</span><span class="token" style="color:#d4d4d4">.</span><span>useEffect </span><span class="token" style="color:#d4d4d4">(</span><span>loadUsers</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span class="token" style="color:#d4d4d4">||</span><span class="token" style="color:#d4d4d4">]</span><span class="token" style="color:#d4d4d4">)</span><span>
</span>
<span>  Html</span><span class="token" style="color:#d4d4d4">.</span><span>div </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">if</span><span> users </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span class="token" style="color:#d4d4d4">]</span><span> </span><span class="token" style="color:#569CD6">then</span><span>
</span><span>      Html</span><span class="token" style="color:#d4d4d4">.</span><span>div </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>        prop</span><span class="token" style="color:#d4d4d4">.</span><span>className </span><span class="token" style="color:#ce9178">&quot;absolute right-1/2 bottom-1/2  transform translate-x-1/2 translate-y-1/2&quot;</span><span>
</span><span>        prop</span><span class="token" style="color:#d4d4d4">.</span><span>children </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>          Daisy</span><span class="token" style="color:#d4d4d4">.</span><span>loading </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>            loading</span><span class="token" style="color:#d4d4d4">.</span><span>spinner
</span><span>            loading</span><span class="token" style="color:#d4d4d4">.</span><span>lg
</span><span>          </span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">]</span><span>
</span>
<span>    </span><span class="token" style="color:#569CD6">else</span><span>
</span><span>      </span><span class="token" style="color:#569CD6">for</span><span> user </span><span class="token" style="color:#569CD6">in</span><span> users </span><span class="token" style="color:#569CD6">do</span><span>
</span><span>      Daisy</span><span class="token" style="color:#d4d4d4">.</span><span>card </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>        card</span><span class="token" style="color:#d4d4d4">.</span><span>bordered
</span><span>        prop</span><span class="token" style="color:#d4d4d4">.</span><span>children </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>            Daisy</span><span class="token" style="color:#d4d4d4">.</span><span>cardBody </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>                Daisy</span><span class="token" style="color:#d4d4d4">.</span><span>cardTitle </span><span class="token" style="color:#d4d4d4">(</span><span>sprintf </span><span class="token" style="color:#ce9178">&quot;%s %s&quot;</span><span> user</span><span class="token" style="color:#d4d4d4">.</span><span>first_name user</span><span class="token" style="color:#d4d4d4">.</span><span>last_name</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>                Html</span><span class="token" style="color:#d4d4d4">.</span><span>p user</span><span class="token" style="color:#d4d4d4">.</span><span>email
</span><span>            </span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">]</span></code></div></pre>
<p>Pretty straight forward stuff, if you squint a little bit its barely noticeable that this is not a standard javascript react component.</p>
<p>We create a function <code node="[object Object]">loadUsers</code> which returns a promise that contains a list of users. We then load the users in the state variable <code node="[object Object]">users</code>. We wrap this function in a <code node="[object Object]">useEffect</code> hook with an empty array so that it is only ever called once.</p>
<p>Make the following changes to the <code node="[object Object]">Components.fs</code> file:</p>
<pre class="mb-3 relative box-shadow shadow-2xl"><div class="absolute -top-1  right-7 h-10 w-10 m-5"><button class="btn btn-xs btn-active"><span class=""><i class="fa-solid fa-copy"> <!-- -->Copy</i></span></button></div><div style="color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e"><code class="language-fsharp" style="color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>  </span><span class="token annotation" style="color:#d4d4d4">[&lt;</span><span class="token annotation" style="color:#4ec9b0">ReactComponent</span><span class="token annotation" style="color:#d4d4d4">&gt;]</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">static</span><span> </span><span class="token" style="color:#569CD6">member</span><span> </span><span class="token" style="color:#dcdcaa">Home</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span>
</span><span>    Html</span><span class="token" style="color:#d4d4d4">.</span><span>div </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>      prop</span><span class="token" style="color:#d4d4d4">.</span><span>className </span><span class="token" style="color:#ce9178">&quot;container mx-auto&quot;</span><span>
</span><span>      prop</span><span class="token" style="color:#d4d4d4">.</span><span>children </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>        Html</span><span class="token" style="color:#d4d4d4">.</span><span>h1 </span><span class="token" style="color:#ce9178">&quot;Home Page&quot;</span><span>
</span><span>        Daisy</span><span class="token" style="color:#d4d4d4">.</span><span>button</span><span class="token" style="color:#d4d4d4">.</span><span>a </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>          prop</span><span class="token" style="color:#d4d4d4">.</span><span>href </span><span class="token" style="color:#ce9178">&quot;/#converter&quot;</span><span>
</span><span>          prop</span><span class="token" style="color:#d4d4d4">.</span><span>text </span><span class="token" style="color:#ce9178">&quot;Converter&quot;</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span>        Daisy</span><span class="token" style="color:#d4d4d4">.</span><span>button</span><span class="token" style="color:#d4d4d4">.</span><span>a </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>          prop</span><span class="token" style="color:#d4d4d4">.</span><span>href </span><span class="token" style="color:#ce9178">&quot;/#elmish-converter&quot;</span><span>
</span><span>          prop</span><span class="token" style="color:#d4d4d4">.</span><span>text </span><span class="token" style="color:#ce9178">&quot;Elmish Converter&quot;</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span>        Daisy</span><span class="token" style="color:#d4d4d4">.</span><span>button</span><span class="token" style="color:#d4d4d4">.</span><span>a </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>          prop</span><span class="token" style="color:#d4d4d4">.</span><span>href </span><span class="token" style="color:#ce9178">&quot;/#fable-fetch&quot;</span><span>
</span><span>          prop</span><span class="token" style="color:#d4d4d4">.</span><span>text </span><span class="token" style="color:#ce9178">&quot;Fable.Fetch&quot;</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">]</span><span>
</span>
<span>  </span><span class="token annotation" style="color:#d4d4d4">[&lt;</span><span class="token annotation" style="color:#4ec9b0">ReactComponent</span><span class="token annotation" style="color:#d4d4d4">&gt;]</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">static</span><span> </span><span class="token" style="color:#569CD6">member</span><span> </span><span class="token" style="color:#dcdcaa">Router</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">let</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span>currentUrl</span><span class="token" style="color:#d4d4d4">,</span><span> updateUrl</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> React</span><span class="token" style="color:#d4d4d4">.</span><span>useState </span><span class="token" style="color:#d4d4d4">(</span><span>Router</span><span class="token" style="color:#d4d4d4">.</span><span>currentUrl </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span>
</span>
<span>    Html</span><span class="token" style="color:#d4d4d4">.</span><span>div </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>      Components</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#dcdcaa">NavBar</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>      React</span><span class="token" style="color:#d4d4d4">.</span><span>router </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>        router</span><span class="token" style="color:#d4d4d4">.</span><span>onUrlChanged updateUrl
</span><span>        router</span><span class="token" style="color:#d4d4d4">.</span><span>children </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>          </span><span class="token" style="color:#569CD6">match</span><span> currentUrl </span><span class="token" style="color:#569CD6">with</span><span>
</span><span>          </span><span class="token" style="color:#d4d4d4">|</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span class="token" style="color:#d4d4d4">]</span><span> </span><span class="token" style="color:#d4d4d4">-&gt;</span><span> Components</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#dcdcaa">Home</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>          </span><span class="token" style="color:#d4d4d4">|</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span> </span><span class="token" style="color:#ce9178">&quot;elmish-converter&quot;</span><span> </span><span class="token" style="color:#d4d4d4">]</span><span> </span><span class="token" style="color:#d4d4d4">-&gt;</span><span> ElmishConverter</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#dcdcaa">TemperatureConverter</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>          </span><span class="token" style="color:#d4d4d4">|</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span> </span><span class="token" style="color:#ce9178">&quot;converter&quot;</span><span> </span><span class="token" style="color:#d4d4d4">]</span><span> </span><span class="token" style="color:#d4d4d4">-&gt;</span><span> Converter</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#dcdcaa">Converter</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>          </span><span class="token" style="color:#d4d4d4">|</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span> </span><span class="token" style="color:#ce9178">&quot;fable-fetch&quot;</span><span> </span><span class="token" style="color:#d4d4d4">]</span><span> </span><span class="token" style="color:#d4d4d4">-&gt;</span><span> FableFetch</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#dcdcaa">FetchData</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>          </span><span class="token" style="color:#d4d4d4">|</span><span> otherwise </span><span class="token" style="color:#d4d4d4">-&gt;</span><span> Html</span><span class="token" style="color:#d4d4d4">.</span><span>h1 </span><span class="token" style="color:#ce9178">&quot;Not found&quot;</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">]</span></code></div></pre>
<p>Run the app and click on button <code node="[object Object]">Fable.Fetch</code>. You should see a loading spinner for a second followed by a list of users.</p>
<p><img src="https://rasheedaboudblogstorage.blob.core.windows.net/blogs/fablefetchclip.gif?sp=r&amp;st=2024-01-06T04:17:17Z&amp;se=2050-01-06T12:17:17Z&amp;spr=https&amp;sv=2022-11-02&amp;sr=b&amp;sig=8KFjMliIEfjo7xqeE9DrL39MIJGk4PS2qATkdKaYB%2BQ%3D" alt="Fable Fetch"/></p>
<p><a href="https://github.com/fable-compiler/fable-fetch">Fable.Fetch</a> is incredibly easy to use. Just remember that this example has no error handling.</p>
<p>In the repo I give another example using an <code node="[object Object]">async</code> computation block instead of a <code node="[object Object]">promise</code>  however the end result is the same. If you prefer not to pull in Fable.Promise package then using <code node="[object Object]">async</code> work fine.</p>
<h2>Feliz.UseDeferred</h2>
<p>Let&#x27;s create a file called <code node="[object Object]">FelizDeferred.fs</code> and install the required nuget package.</p>
<pre class="mb-3 relative box-shadow shadow-2xl"><div class="absolute -top-1  right-7 h-10 w-10 m-5"><button class="btn btn-xs btn-active"><span class=""><i class="fa-solid fa-copy"> <!-- -->Copy</i></span></button></div><div style="color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e"><code class="language-console" style="color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>femto install Feliz.UseDeferred ./src</span></code></div></pre>
<p>We can re-use our domain model from previous however we will quickly pull out the logic to load users into its own module, this is 100% not required its just something i like to do.</p>
<pre class="mb-3 relative box-shadow shadow-2xl"><div class="absolute -top-1  right-7 h-10 w-10 m-5"><button class="btn btn-xs btn-active"><span class=""><i class="fa-solid fa-copy"> <!-- -->Copy</i></span></button></div><div style="color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e"><code class="language-fsharp" style="color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#569CD6">module</span><span> Domain
</span><span></span><span class="token" style="color:#569CD6">open</span><span> Fable</span><span class="token" style="color:#d4d4d4">.</span><span>Core
</span><span></span><span class="token" style="color:#569CD6">open</span><span> Fetch
</span>
<span></span><span class="token" style="color:#569CD6">type</span><span> </span><span class="token" style="color:#4ec9b0">User</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">{</span><span> id</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">int</span><span>
</span><span>    first_name</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">string</span><span>
</span><span>    last_name</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">string</span><span>
</span><span>    email</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">string</span><span> </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span></span><span class="token annotation" style="color:#d4d4d4">[&lt;</span><span class="token annotation" style="color:#4ec9b0">RequireQualifiedAccess</span><span class="token annotation" style="color:#d4d4d4">&gt;]</span><span>
</span><span></span><span class="token" style="color:#569CD6">module</span><span> User </span><span class="token" style="color:#d4d4d4">=</span><span>
</span><span>  </span><span class="token" style="color:#6a9955">//Required for useDeferred</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">let</span><span> loadUsersAsync </span><span class="token" style="color:#d4d4d4">=</span><span>
</span><span>    </span><span class="token computation-expression" style="color:#569CD6">async</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      </span><span class="token" style="color:#569CD6">let!</span><span> response </span><span class="token" style="color:#d4d4d4">=</span><span>
</span><span>        fetch </span><span class="token" style="color:#ce9178">&quot;https://random-data-api.com/api/v2/users?size=10&quot;</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">|&gt;</span><span> Async</span><span class="token" style="color:#d4d4d4">.</span><span>AwaitPromise
</span>
<span>      </span><span class="token" style="color:#569CD6">if</span><span> response</span><span class="token" style="color:#d4d4d4">.</span><span>Ok </span><span class="token" style="color:#569CD6">then</span><span>
</span><span>        </span><span class="token" style="color:#569CD6">let!</span><span> users </span><span class="token" style="color:#d4d4d4">=</span><span> response</span><span class="token" style="color:#d4d4d4">.</span><span>json</span><span class="token" style="color:#d4d4d4">&lt;</span><span>User list</span><span class="token" style="color:#d4d4d4">&gt;</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">|&gt;</span><span> Async</span><span class="token" style="color:#d4d4d4">.</span><span>AwaitPromise
</span><span>        </span><span class="token" style="color:#569CD6">return</span><span> users
</span><span>      </span><span class="token" style="color:#569CD6">else</span><span>
</span><span>        </span><span class="token" style="color:#569CD6">return</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>  </span><span class="token" style="color:#6a9955">//Required for out Fetch example</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">let</span><span> loadUsers setUsers </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span>
</span><span>    </span><span class="token computation-expression" style="color:#569CD6">promise</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      </span><span class="token" style="color:#569CD6">let!</span><span> response </span><span class="token" style="color:#d4d4d4">=</span><span> fetch </span><span class="token" style="color:#ce9178">&quot;https://random-data-api.com/api/v2/users?size=10&quot;</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span class="token" style="color:#d4d4d4">]</span><span>
</span>
<span>      </span><span class="token" style="color:#569CD6">if</span><span> response</span><span class="token" style="color:#d4d4d4">.</span><span>Ok </span><span class="token" style="color:#569CD6">then</span><span>
</span><span>        </span><span class="token" style="color:#569CD6">let!</span><span> users </span><span class="token" style="color:#d4d4d4">=</span><span> response</span><span class="token" style="color:#d4d4d4">.</span><span>json</span><span class="token" style="color:#d4d4d4">&lt;</span><span>User list</span><span class="token" style="color:#d4d4d4">&gt;</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>        setUsers </span><span class="token" style="color:#d4d4d4">(</span><span>users</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">|&gt;</span><span> Promise</span><span class="token" style="color:#d4d4d4">.</span><span>start</span></code></div></pre>
<p>Update our <code node="[object Object]">FetchData.fs</code> to use our new <code node="[object Object]">loadUsers</code> function:</p>
<pre class="mb-3 relative box-shadow shadow-2xl"><div class="absolute -top-1  right-7 h-10 w-10 m-5"><button class="btn btn-xs btn-active"><span class=""><i class="fa-solid fa-copy"> <!-- -->Copy</i></span></button></div><div style="color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e"><code class="language-fsharp" style="color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#569CD6">open</span><span> Domain
</span>
<span></span><span class="token annotation" style="color:#d4d4d4">[&lt;</span><span class="token annotation" style="color:#4ec9b0">ReactComponent</span><span class="token annotation" style="color:#d4d4d4">&gt;]</span><span>
</span><span></span><span class="token" style="color:#569CD6">let</span><span> FetchData </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">let</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span>users</span><span class="token" style="color:#d4d4d4">,</span><span> setUsers</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> React</span><span class="token" style="color:#d4d4d4">.</span><span>useState </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">[</span><span class="token" style="color:#d4d4d4">]</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>  React</span><span class="token" style="color:#d4d4d4">.</span><span>useEffect </span><span class="token" style="color:#d4d4d4">(</span><span>User</span><span class="token" style="color:#d4d4d4">.</span><span>loadUsers setUsers</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span class="token" style="color:#d4d4d4">||</span><span class="token" style="color:#d4d4d4">]</span><span class="token" style="color:#d4d4d4">)</span><span>
</span>
<span>  </span><span class="token" style="color:#d4d4d4">..</span><span class="token" style="color:#d4d4d4">.</span><span> </span></code></div></pre>
<p>Now we can go back to our <code node="[object Object]">FelizDeferred</code> component and finish it off:</p>
<pre class="mb-3 relative box-shadow shadow-2xl"><div class="absolute -top-1  right-7 h-10 w-10 m-5"><button class="btn btn-xs btn-active"><span class=""><i class="fa-solid fa-copy"> <!-- -->Copy</i></span></button></div><div style="color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e"><code class="language-fsharp" style="color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#569CD6">module</span><span> FelizDeferred
</span>
<span></span><span class="token" style="color:#569CD6">open</span><span> Feliz
</span><span></span><span class="token" style="color:#569CD6">open</span><span> Feliz</span><span class="token" style="color:#d4d4d4">.</span><span>UseDeferred
</span><span></span><span class="token" style="color:#569CD6">open</span><span> Feliz</span><span class="token" style="color:#d4d4d4">.</span><span>DaisyUI
</span><span></span><span class="token" style="color:#569CD6">open</span><span> Domain
</span>
<span></span><span class="token" style="color:#569CD6">let</span><span> Spinner </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span>
</span><span>  Html</span><span class="token" style="color:#d4d4d4">.</span><span>div </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>    prop</span><span class="token" style="color:#d4d4d4">.</span><span>className </span><span class="token" style="color:#ce9178">&quot;absolute right-1/2 bottom-1/2  transform translate-x-1/2 translate-y-1/2&quot;</span><span>
</span><span>    prop</span><span class="token" style="color:#d4d4d4">.</span><span>children </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>      Daisy</span><span class="token" style="color:#d4d4d4">.</span><span>loading </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>        loading</span><span class="token" style="color:#d4d4d4">.</span><span>spinner
</span><span>        loading</span><span class="token" style="color:#d4d4d4">.</span><span>lg
</span><span>      </span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">]</span><span>
</span>
<span></span><span class="token" style="color:#569CD6">let</span><span> Error </span><span class="token" style="color:#d4d4d4">(</span><span>message</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">string</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span>
</span><span>  Daisy</span><span class="token" style="color:#d4d4d4">.</span><span>card </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>    card</span><span class="token" style="color:#d4d4d4">.</span><span>bordered
</span><span>    prop</span><span class="token" style="color:#d4d4d4">.</span><span>children </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>      Daisy</span><span class="token" style="color:#d4d4d4">.</span><span>cardBody </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>        Daisy</span><span class="token" style="color:#d4d4d4">.</span><span>cardTitle </span><span class="token" style="color:#ce9178">&quot;An error occurred!&quot;</span><span>
</span><span>        Html</span><span class="token" style="color:#d4d4d4">.</span><span>p message
</span><span>      </span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">]</span><span>
</span>
<span></span><span class="token" style="color:#569CD6">let</span><span> UserCard </span><span class="token" style="color:#d4d4d4">(</span><span>props</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span class="token" style="color:#d4d4d4">|</span><span> users</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">User</span><span> list </span><span class="token" style="color:#d4d4d4">|</span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span>
</span><span>  Html</span><span class="token" style="color:#d4d4d4">.</span><span>div </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">for</span><span> user </span><span class="token" style="color:#569CD6">in</span><span> users </span><span class="token" style="color:#569CD6">do</span><span>
</span><span>      Daisy</span><span class="token" style="color:#d4d4d4">.</span><span>card </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>        card</span><span class="token" style="color:#d4d4d4">.</span><span>bordered
</span><span>        prop</span><span class="token" style="color:#d4d4d4">.</span><span>children </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>          Daisy</span><span class="token" style="color:#d4d4d4">.</span><span>cardBody </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>            Daisy</span><span class="token" style="color:#d4d4d4">.</span><span>cardTitle </span><span class="token" style="color:#d4d4d4">(</span><span>sprintf </span><span class="token" style="color:#ce9178">&quot;%s %s&quot;</span><span> user</span><span class="token" style="color:#d4d4d4">.</span><span>first_name user</span><span class="token" style="color:#d4d4d4">.</span><span>last_name</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>            Html</span><span class="token" style="color:#d4d4d4">.</span><span>p user</span><span class="token" style="color:#d4d4d4">.</span><span>email
</span><span>          </span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">]</span><span>
</span>
<span></span><span class="token annotation" style="color:#d4d4d4">[&lt;</span><span class="token annotation" style="color:#4ec9b0">ReactComponent</span><span class="token annotation" style="color:#d4d4d4">&gt;]</span><span>
</span><span></span><span class="token" style="color:#569CD6">let</span><span> Deferred </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">let</span><span> data </span><span class="token" style="color:#d4d4d4">=</span><span> React</span><span class="token" style="color:#d4d4d4">.</span><span>useDeferred </span><span class="token" style="color:#d4d4d4">(</span><span>User</span><span class="token" style="color:#d4d4d4">.</span><span>loadUsersAsync</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span class="token" style="color:#d4d4d4">||</span><span class="token" style="color:#d4d4d4">]</span><span class="token" style="color:#d4d4d4">)</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">match</span><span> data </span><span class="token" style="color:#569CD6">with</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">|</span><span> Deferred</span><span class="token" style="color:#d4d4d4">.</span><span>HasNotStartedYet </span><span class="token" style="color:#d4d4d4">-&gt;</span><span> Html</span><span class="token" style="color:#d4d4d4">.</span><span>none
</span><span>  </span><span class="token" style="color:#d4d4d4">|</span><span> Deferred</span><span class="token" style="color:#d4d4d4">.</span><span>InProgress </span><span class="token" style="color:#d4d4d4">-&gt;</span><span> </span><span class="token" style="color:#dcdcaa">Spinner</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">|</span><span> Deferred</span><span class="token" style="color:#d4d4d4">.</span><span>Failed error </span><span class="token" style="color:#d4d4d4">-&gt;</span><span> Error error</span><span class="token" style="color:#d4d4d4">.</span><span>Message
</span><span>  </span><span class="token" style="color:#d4d4d4">|</span><span> Deferred</span><span class="token" style="color:#d4d4d4">.</span><span>Resolved content </span><span class="token" style="color:#d4d4d4">-&gt;</span><span> </span><span class="token computation-expression" style="color:#569CD6">UserCard</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span class="token" style="color:#d4d4d4">|</span><span> users </span><span class="token" style="color:#d4d4d4">=</span><span> content </span><span class="token" style="color:#d4d4d4">|</span><span class="token" style="color:#d4d4d4">}</span></code></div></pre>
<p>Add button to navigate in our <code node="[object Object]">Home</code> component</p>
<pre class="mb-3 relative box-shadow shadow-2xl"><div class="absolute -top-1  right-7 h-10 w-10 m-5"><button class="btn btn-xs btn-active"><span class=""><i class="fa-solid fa-copy"> <!-- -->Copy</i></span></button></div><div style="color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e"><code class="language-fsharp" style="color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>Daisy</span><span class="token" style="color:#d4d4d4">.</span><span>button</span><span class="token" style="color:#d4d4d4">.</span><span>a </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>    prop</span><span class="token" style="color:#d4d4d4">.</span><span>href </span><span class="token" style="color:#ce9178">&quot;/#feliz-deferred&quot;</span><span>
</span><span>    prop</span><span class="token" style="color:#d4d4d4">.</span><span>text </span><span class="token" style="color:#ce9178">&quot;Feliz.Deferred&quot;</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">]</span></code></div></pre>
<p>And update our router with our new page:</p>
<pre class="mb-3 relative box-shadow shadow-2xl"><div class="absolute -top-1  right-7 h-10 w-10 m-5"><button class="btn btn-xs btn-active"><span class=""><i class="fa-solid fa-copy"> <!-- -->Copy</i></span></button></div><div style="color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e"><code class="language-fsharp" style="color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>  </span><span class="token annotation" style="color:#d4d4d4">[&lt;</span><span class="token annotation" style="color:#4ec9b0">ReactComponent</span><span class="token annotation" style="color:#d4d4d4">&gt;]</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">static</span><span> </span><span class="token" style="color:#569CD6">member</span><span> </span><span class="token" style="color:#dcdcaa">Router</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">let</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span>currentUrl</span><span class="token" style="color:#d4d4d4">,</span><span> updateUrl</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> React</span><span class="token" style="color:#d4d4d4">.</span><span>useState </span><span class="token" style="color:#d4d4d4">(</span><span>Router</span><span class="token" style="color:#d4d4d4">.</span><span>currentUrl </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span>
</span>
<span>    Html</span><span class="token" style="color:#d4d4d4">.</span><span>div </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>      Components</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#dcdcaa">NavBar</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>      React</span><span class="token" style="color:#d4d4d4">.</span><span>router </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>        router</span><span class="token" style="color:#d4d4d4">.</span><span>onUrlChanged updateUrl
</span><span>        router</span><span class="token" style="color:#d4d4d4">.</span><span>children </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>          </span><span class="token" style="color:#569CD6">match</span><span> currentUrl </span><span class="token" style="color:#569CD6">with</span><span>
</span><span>          </span><span class="token" style="color:#d4d4d4">|</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span class="token" style="color:#d4d4d4">]</span><span> </span><span class="token" style="color:#d4d4d4">-&gt;</span><span> Components</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#dcdcaa">Home</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>          </span><span class="token" style="color:#d4d4d4">|</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span> </span><span class="token" style="color:#ce9178">&quot;elmish-converter&quot;</span><span> </span><span class="token" style="color:#d4d4d4">]</span><span> </span><span class="token" style="color:#d4d4d4">-&gt;</span><span> ElmishConverter</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#dcdcaa">TemperatureConverter</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>          </span><span class="token" style="color:#d4d4d4">|</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span> </span><span class="token" style="color:#ce9178">&quot;converter&quot;</span><span> </span><span class="token" style="color:#d4d4d4">]</span><span> </span><span class="token" style="color:#d4d4d4">-&gt;</span><span> Converter</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#dcdcaa">Converter</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>          </span><span class="token" style="color:#d4d4d4">|</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span> </span><span class="token" style="color:#ce9178">&quot;fable-fetch&quot;</span><span> </span><span class="token" style="color:#d4d4d4">]</span><span> </span><span class="token" style="color:#d4d4d4">-&gt;</span><span> FableFetch</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#dcdcaa">FetchData</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>          </span><span class="token" style="color:#d4d4d4">|</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span> </span><span class="token" style="color:#ce9178">&quot;feliz-deferred&quot;</span><span> </span><span class="token" style="color:#d4d4d4">]</span><span> </span><span class="token" style="color:#d4d4d4">-&gt;</span><span> FelizDeferred</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#dcdcaa">Deferred</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>          </span><span class="token" style="color:#d4d4d4">|</span><span> otherwise </span><span class="token" style="color:#d4d4d4">-&gt;</span><span> Html</span><span class="token" style="color:#d4d4d4">.</span><span>h1 </span><span class="token" style="color:#ce9178">&quot;Not found&quot;</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">]</span></code></div></pre>
<p>Run the app and check out the new page! It should render out exactly the same as out previous component.</p>
<p>One of my favorite parts of using this method for data fetching is it forces me to consider and handle all the loading states and tends to help give a better user experience. I typically break out most of the states into re-usable components, that way I ony need to implement the case where data has loaded successfully.</p>
<h2>Summary</h2>
<p>Hey there! In the latest chapter of our web development journey with F# using Feliz and Fable, we took a thrilling dive into the world of asynchronicity and data fetching. We explored how to make our web application come alive by reaching out to external services for fresh, dynamic data. I showed you two awesome methods for doing this: Fable.Fetch and React.useDeferred.</p>
<p>We started by setting sail with Fable.Fetch, installed the necessary packages, and created a nifty example to fetch random user data from an API. I walked you through creating a <code node="[object Object]">loadUsers</code> async function wrapped in a <code node="[object Object]">useEffect</code> hook to load the users once and populate our app&#x27;s UI with the data received.</p>
<p>Then, I introduced the magical world of React.useDeferred. We created a new component, separated our fetching logic, and managed to render similar output to our Fable.Fetch example, with beautiful loading state management right out of the box!</p>
<p>Both methods were super easy and fun to implement, adding that connectedness and richness to our F# web application. In our next post, we&#x27;ll raise the stakes even higher as we learn how to wrap third-party components into our app. It&#x27;s going to be fantastic, and I can&#x27;t wait to show you how!</p>
<p>Stay tuned, and keep it upbeat, as our adventure only gets more exciting from here!</p><div class="my-5 py-5"><a class="btn btn-neutral" href="/blogs">Go Back</a></div></div></article></div></div></div><footer class="footer  p-10 bg-black text-neutral-content"><aside><svg class="me-auto" width="50" height="50" viewBox="-20 -20 100 100"><g id="SvgjsG1201" transform="scale(1.0)" fill="#fff"><path xmlns="http://www.w3.org/2000/svg" d="M2.61,37.02a1.45852,1.45852,0,0,1-.11-.55V4A1.498,1.498,0,0,1,4,2.5H15.77a1.50728,1.50728,0,0,1,1.06.44L27.18,13.29a1.49682,1.49682,0,0,1,0,2.12L5.06,37.53A1.50653,1.50653,0,0,1,2.61,37.02Z"></path><path xmlns="http://www.w3.org/2000/svg" d="M61.5,4V15.77a1.809,1.809,0,0,1-.11.57,1.62577,1.62577,0,0,1-.33.49L50.71,27.18a1.50713,1.50713,0,0,1-2.12,0L26.47,5.06a1.5155,1.5155,0,0,1,.4901-2.45,1.79313,1.79313,0,0,1,.57-.11L60,2.5A1.498,1.498,0,0,1,61.5,4Z"></path><path xmlns="http://www.w3.org/2000/svg" d="M61.39,26.98a1.45841,1.45841,0,0,1,.11.55V60A1.498,1.498,0,0,1,60,61.5H48.23a1.50747,1.50747,0,0,1-1.06-.44L36.82,50.71a1.49678,1.49678,0,0,1,0-2.12L58.94,26.47A1.50658,1.50658,0,0,1,61.39,26.98Z"></path><path xmlns="http://www.w3.org/2000/svg" d="M19.17,30.94,30.94,19.17a1.509,1.509,0,0,1,2.12,0L44.83,30.94a1.50907,1.50907,0,0,1,0,2.12L33.06,44.83a1.51876,1.51876,0,0,1-2.12,0L19.17,33.06A1.50906,1.50906,0,0,1,19.17,30.94Z"></path><path xmlns="http://www.w3.org/2000/svg" d="M37.86,59.45a1.50661,1.50661,0,0,1-1.39,2.05L4,61.5A1.498,1.498,0,0,1,2.5,60V48.23a1.81029,1.81029,0,0,1,.11-.57,1.62669,1.62669,0,0,1,.33-.49L13.29,36.82a1.54761,1.54761,0,0,1,2.12,0L37.53,58.94A1.28931,1.28931,0,0,1,37.86,59.45Z"></path></g></svg><p>Rasheed Aboud.<br/>Providing reliable tech solutions since 2017.</p></aside><nav><header class="footer-title">Social</header><div class="grid grid-flow-col gap-4"><a href="https://twitter.com/@rasheed_aboud"><img alt="twitter" style="max-width:20px;max-height:25px" src="data:image/webp;base64,UklGRowEAABXRUJQVlA4TIAEAAAvMYAMEC8GoY0kSZLnwB/YA/BOZSYNCG0kSZI8B/7AHoB3KjMhtJEkSfIc+AN7AN6pzIQc23bb5gJCUnBaetyG+9+nBtyIB/gxABIDDRUNEwMdFR0NHQ0DEzdctxUoAgeCA4HhwKAwBAIKh8GgUBgMAYcj4BAIBAaHwWEQCAyKDYFBcBAwbCgUhg2FQz8+PuJ5ntvzPLfned6e55GPj4833J/nuaE+z3NDR8MV72joaNs6nrb1bf+wbQu1bWvL3dGWbbRlW7YtWG13W5KQhLYkYRttSUIStnF3tCUJ29hGW/7//0lCEtrSliS0/W37eXfcHUnYxvu+vO9LEu4u25a7y21lG3fH+760JUlsq9vi9/e3tC1J8u/vL5PUtpakbQP2vm+i////c3eWpLzv69vG3bHt/P//Z9tyd/Pu7O7atn13q+1uu+5uJ1nb9rZL276NbbvturudZG07bWcStp0kc5ts+4NAv7+/v5N8fX19fXx+fl4hwbZt045ObNtcsZOybVvB/2Xbtm3btl0dq9x33n2/BRH9N5C2TTsL/T2IDEW3h3gwrjXov79FpJvL/tgTOefM6nWvJ8p/Cmrg8BXDC/OozrclbMo1fDd/hEqnqbDmW5DheehqSfDk+37OTw8X015wzKRjOwy2Y/yLRRyaHSMOiuvw3TX3djHl2TaM+rSSXW0JophRxorP5q5DU6k7w2duYv334aLaD/aaBO2DAa4ktO5ixafRorOwEW6YfFxGWaYL0bOPsPjFOHEzu5zF783dgfoSlYjpZ5n74FewuDoIdnSYOwh9NEJ+3PJxdUqYWNgFLph8WwNpChMfzePMjAixIbeSec/NPfRTW+Rg7Lsl7G+NEzuHwaZZ5k5AT5ORX9ewrTVRbO0Bp01mbXSkkNS6hXXfR4g1hbX4Hpp7Pp+qvM6w9rL03RjxYBqs1lOImnOc+U8miCd7w2Ethb9Tr+K7/SPEGyX14EjhzWLmX/NzYVq4WOmSwrKP5q6Aj8NzosWz/WFPkOleWNsaL94pbYbrSgr+fxIIsytY9FJNISAbDFvblRT6BgDzCp53pLAK0gJCfjXznqopBGR/YJ2aQkAYuxtOaCkkB4DRn1aipPB0HlX5nklq3cwqHyu/mDsHXb0S37qH5R92wkFHCttgiDei5hxjwbMJCxvglpJCRY4XwqddwH/vZ7BklbFUS6G51J6Qn/f8XJraeeEGwK4Oc7thoD0Tny3gxJwoI4UWuKJeZ1vGfFjGvtZ45xXUU2gosWPE97VsnpkkDofAFkcKB2xTSGzbzuqvI11SOGvyZRVl6RbEth5g6buxolFQjf+xIwWfTQoRM04x/8kk0U3RUjgOPa1fuIs94bgjhQ2Q7PbCH+gv3OUxKynUFKiMe7W484XbXcGVn82dha72L9z1Me/XUhiqhOXywi0e8001BSUs44VbmlXGkvfmLkOLywu3diDscEshfNp5/YVbPuaLegohP27rL9z2MS84cfLk0cOHD2+CBpn0et26szMixJND0f0d1D579oxY8Wh3FQA="/></a><a aria-label="YouTube" href="https://www.youtube.com/channel/UCtdi6hMM5p6gAchK67qYPqQ"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"></path></svg></a><a aria-label="Facebook" href="https://www.facebook.com/profile.php?id=100078327618426"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"></path></svg></a><a href="https://github.com/rasheedaboud"><img alt="Github" style="max-width:25px;max-height:25px" src="data:image/svg+xml,%3c?xml%20version=&#x27;1.0&#x27;%20encoding=&#x27;UTF-8&#x27;%20standalone=&#x27;no&#x27;?%3e%3csvg%20width=&#x27;25&#x27;%20height=&#x27;25&#x27;%20viewBox=&#x27;0%200%2025%2025&#x27;%20version=&#x27;1.1&#x27;%20id=&#x27;svg4&#x27;%20sodipodi:docname=&#x27;github.svg&#x27;%20inkscape:version=&#x27;1.1.1%20(3bf5ae0d25,%202021-09-20)&#x27;%20xmlns:inkscape=&#x27;http://www.inkscape.org/namespaces/inkscape&#x27;%20xmlns:sodipodi=&#x27;http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd&#x27;%20xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%20xmlns:svg=&#x27;http://www.w3.org/2000/svg&#x27;%3e%3cdefs%20id=&#x27;defs8&#x27;%20/%3e%3csodipodi:namedview%20id=&#x27;namedview6&#x27;%20pagecolor=&#x27;%23ffffff&#x27;%20bordercolor=&#x27;%23666666&#x27;%20borderopacity=&#x27;1.0&#x27;%20inkscape:pageshadow=&#x27;2&#x27;%20inkscape:pageopacity=&#x27;0.0&#x27;%20inkscape:pagecheckerboard=&#x27;0&#x27;%20showgrid=&#x27;false&#x27;%20inkscape:zoom=&#x27;17.458333&#x27;%20inkscape:cx=&#x27;13.431981&#x27;%20inkscape:cy=&#x27;11.97136&#x27;%20inkscape:window-width=&#x27;1920&#x27;%20inkscape:window-height=&#x27;992&#x27;%20inkscape:window-x=&#x27;-8&#x27;%20inkscape:window-y=&#x27;-8&#x27;%20inkscape:window-maximized=&#x27;1&#x27;%20inkscape:current-layer=&#x27;layer1&#x27;%20/%3e%3cg%20inkscape:groupmode=&#x27;layer&#x27;%20id=&#x27;layer1&#x27;%20inkscape:label=&#x27;Layer%201&#x27;%20style=&#x27;display:inline&#x27;%3e%3crect%20style=&#x27;display:inline;fill:%23000000;stroke:%23000000;stroke-width:7.80066&#x27;%20id=&#x27;rect1616&#x27;%20width=&#x27;17.199343&#x27;%20height=&#x27;17.199343&#x27;%20x=&#x27;3.9003301&#x27;%20y=&#x27;3.9003301&#x27;%20/%3e%3cpath%20d=&#x27;m%2012.499999,0.50606967%20c%20-6.6226476,0%20-11.99392933,5.50704133%20-11.99392933,12.29936633%200,5.43427%203.43626083,10.044482%208.20284793,11.671074%200.5986976,0.113769%200.7925992,-0.267511%200.7925992,-0.591395%20V%2021.595384%20C%206.1652056,22.339495%205.4705566,20.144058%205.4705566,20.144058%204.9248328,18.722456%204.1382316,18.344251%204.1382316,18.344251%20c%20-1.088449,-0.763586%200.08296,-0.747188%200.08296,-0.747188%201.2043901,0.0861%201.8380697,1.267861%201.8380697,1.267861%201.0694583,1.879752%202.8055797,1.336531%203.4902334,1.021872%200.1069456,-0.794333%200.417788,-1.337555%200.7616143,-1.644015%20-2.6636519,-0.312609%20-5.4642343,-1.36728%20-5.4642343,-6.078962%200,-1.343706%200.468763,-2.4403988%201.2353746,-3.3013549%20-0.1239379,-0.3105589%20-0.53473,-1.5620194%200.1169404,-3.2552323%200,0%201.0074901,-0.3300329%203.2993304,1.2606851%20C%2010.455036,6.595281%2011.480517,6.458963%2012.500001,6.4538382%20c%201.019484,0.00512%202.045965,0.1414428%203.004479,0.4140787%202.28984,-1.590718%203.295332,-1.2606851%203.295332,-1.2606851%200.65267,1.6942378%200.241878,2.9456983%200.117941,3.2552323%200.76961,0.8609561%201.234375,1.9586729%201.234375,3.3013549%200,4.723982%20-2.80558,5.764303%20-5.476228,6.068713%200.429782,0.38128%200.822584,1.129491%200.822584,2.277432%20v%203.375151%20c%200,0.326959%200.191902,0.711313%200.800594,0.59037%204.76259,-1.628642%208.194852,-6.237829%208.194852,-11.670049%200,-6.792325%20-5.370281,-12.29936633%20-11.993929,-12.29936633%20z&#x27;%20id=&#x27;path2&#x27;%20style=&#x27;display:inline;fill:%23ffffff;stroke:%23000000;stroke-width:1.01214&#x27;%20/%3e%3c/g%3e%3c/svg%3e"/></a></div></nav></footer></main></div>
        <script id="vike_pageContext" type="application/json">{"pageProps":{"blog":{"odata.metadata":"https://rasheedaboudblogstorage.table.core.windows.net/$metadata#blogs/@Element","etag":"W/\"datetime'2024-01-12T23%3A55%3A27.7889991Z'\"","partitionKey":"blogs","rowKey":"part-5-using-fetch-apis-in-fable","timestamp":"2024-01-12T23:55:27.7889991Z","author":"Rasheed Aboud","date":"2024-1-5","description":"Explore data fetching in F# web apps using Feliz and Fable by integrating the Fetch API with promises and React hooks. Learn through a practical example that retrieves user data asynchronously, utilizing the Fable.Fetch library and the Feliz.UseDeferred hook for efficient and type-safe HTTP requests in a functional programming paradigm.","readTime":"6 min","tags":"F#,react,fable,feliz,web development","thumbnail":"https://rasheedaboudblogstorage.blob.core.windows.net/blogs/reactdatafetching.webp?sp=r&st=2024-01-06T20:23:08Z&se=2050-01-07T04:23:08Z&spr=https&sv=2022-11-02&sr=b&sig=yx13rMbse%2BA1YoaSm%2FLTSQ8AGoQFSRF5W93Go8XN%2FCQ%3D","title":"Part 5-Using Fetch APIs in Fable","markdown":"## TL;DR\r\n\r\nIn this post we expanded our F# web application's functionality with Feliz and Fable by exploring asynchronous HTTP requests to pull in live data from an external service. We walked through two methods: using Fable.Fetch along with promises and Fable.Promise for async calls, and using React.useDeferred for deferred data fetching with better loading state management. We created examples to fetch random user data from an API upon loading the page, showcasing loading states and data rendering in our app's UI. Both methods were straightforward, enhancing our app with dynamic, real-time content. Next, we'll explore how to integrate third-party components into our F# web app.\r\n\r\n## Background\r\n\r\nWelcome back to our adventurous journey through the world of web development with F# using Feliz and Fable! In our previous chapters, we've established a sturdy foundation of our F# web application, crafting interactive UI components with state management techniques. But our application isn't an isolated island; it needs to communicate with the vast and dynamic world of the internet. It's time to broaden our horizons and venture into the realm of asynchronicity and data fetching.\r\n\r\nIn this post, we'll elevate our application's capabilities by learning how to reach out to external services using promises and the Fetch API. Our focus will be on how to make asynchronous HTTP requests that breathe life into our app with fresh, live data from various sources. We'll examine the practical uses of promises in F#, how to handle responses and potential errors gracefully, and how to integrate these asynchronous patterns within our functional program design.\r\n\r\nAs we embark on this path, weâ€™ll get a closer look at employing typed HttpClient instances and integrate these with our Elmish components, ensuring type safety and functional clarity across our application. By the end of this guide, you will have the tools to make your F# web applications not only interactive but also connected and data-rich.\r\n\r\nPrepare to unlock the full potential of your web applications with F# and Fable!\r\n\r\n## The Plan\r\n\r\nFor this demonstration, we will load some data from a third party using browser fetch API to get some random data from [random-data-api](https://random-data-api.com/api/v2/users). I will show you two ways of completing the task\r\n\r\n1. [Fable.Fetch](https://github.com/fable-compiler/fable-fetch)\r\n2. [React.useDeferred](https://zaid-ajaj.github.io/Feliz/#/Hooks/UseDeferred)\r\n\r\nBoth are dead simple to use, each having it's own pro and cons.\r\n\r\n## Prerequisites\r\n\r\nGrab the code form [Part 4](https://github.com/rasheedaboud/FSharp-Web-Development/tree/main/Part%204%20-State%20Management). It should contain all the required bits to get going.\r\n\r\nHere is a short list of the requirements to run the app:\r\n\r\n- .Net 8\r\n- Node ^18\r\n- npm | pnpm | yarn\r\n- [Visual Studio Code](https://code.visualstudio.com/) with [Ionide](http://ionide.io/)\r\n- [Highlight templates in F#](https://marketplace.visualstudio.com/items?itemName=alfonsogarciacaro.vscode-template-fsharp-highlight)\r\n\r\n## Fable.Fetch\r\n\r\nLets dive right in and install the required nuget packages.\r\n\r\n```console\r\nfemto install Fable.Fetch ./src\r\nfemto install Fable.Promise ./src\r\n```\r\n\r\nNext lets create a new F# file called, you got it ``FableFetch.fs`` to hold our example using the fetch api and ``Domain.fs`` where we will create a subtype of the field return by the API we will be using.\r\n\r\n``Domain.fs``\r\n\r\n```fsharp\r\nmodule Domain\r\n\r\ntype User =\r\n  { id: int\r\n    first_name: string\r\n    last_name: string\r\n    email: string }\r\n```\r\n\r\n``FableFetch.fs``\r\n\r\n```fsharp\r\nmodule FableFetch\r\n\r\nopen Domain\r\nopen Feliz\r\nopen Feliz.DaisyUI\r\nopen Fetch\r\n\r\n[\u003cReactComponent>]\r\nlet FetchData () =\r\n\r\n  let (users, setUsers) = React.useState ([])\r\n\r\n  let loadUsers () =\r\n    promise {\r\n      let! response = fetch \"https://random-data-api.com/api/v2/users?size=10\" []\r\n      if response.Ok then\r\n        let! users = response.json\u003cUser list> ()\r\n        setUsers (users)\r\n    }\r\n    //we need this to make useEffect happy...\r\n    |> Promise.start\r\n\r\n\r\n  React.useEffect (loadUsers, [||])\r\n\r\n  Html.div [\r\n    if users = [] then\r\n      Html.div [\r\n        prop.className \"absolute right-1/2 bottom-1/2  transform translate-x-1/2 translate-y-1/2\"\r\n        prop.children [\r\n          Daisy.loading [\r\n            loading.spinner\r\n            loading.lg\r\n          ]\r\n        ]\r\n      ]\r\n\r\n    else\r\n      for user in users do\r\n      Daisy.card [\r\n        card.bordered\r\n        prop.children [\r\n            Daisy.cardBody [\r\n                Daisy.cardTitle (sprintf \"%s %s\" user.first_name user.last_name)\r\n                Html.p user.email\r\n            ]\r\n        ]\r\n      ]\r\n  ]\r\n```\r\n\r\nPretty straight forward stuff, if you squint a little bit its barely noticeable that this is not a standard javascript react component.\r\n\r\nWe create a function ``loadUsers`` which returns a promise that contains a list of users. We then load the users in the state variable ``users``. We wrap this function in a ``useEffect`` hook with an empty array so that it is only ever called once.\r\n\r\nMake the following changes to the `Components.fs` file:\r\n\r\n```fsharp\r\n  [\u003cReactComponent>]\r\n  static member Home() =\r\n    Html.div [\r\n      prop.className \"container mx-auto\"\r\n      prop.children [\r\n        Html.h1 \"Home Page\"\r\n        Daisy.button.a [\r\n          prop.href \"/#converter\"\r\n          prop.text \"Converter\"\r\n        ]\r\n        Daisy.button.a [\r\n          prop.href \"/#elmish-converter\"\r\n          prop.text \"Elmish Converter\"\r\n        ]\r\n        Daisy.button.a [\r\n          prop.href \"/#fable-fetch\"\r\n          prop.text \"Fable.Fetch\"\r\n        ]\r\n      ]\r\n    ]\r\n\r\n  [\u003cReactComponent>]\r\n  static member Router() =\r\n    let (currentUrl, updateUrl) = React.useState (Router.currentUrl ())\r\n\r\n    Html.div [\r\n      Components.NavBar()\r\n      React.router [\r\n        router.onUrlChanged updateUrl\r\n        router.children [\r\n          match currentUrl with\r\n          | [] -> Components.Home()\r\n          | [ \"elmish-converter\" ] -> ElmishConverter.TemperatureConverter()\r\n          | [ \"converter\" ] -> Converter.Converter()\r\n          | [ \"fable-fetch\" ] -> FableFetch.FetchData()\r\n          | otherwise -> Html.h1 \"Not found\"\r\n        ]\r\n      ]\r\n    ]\r\n```\r\n\r\nRun the app and click on button `Fable.Fetch`. You should see a loading spinner for a second followed by a list of users.\r\n\r\n![Fable Fetch](https://rasheedaboudblogstorage.blob.core.windows.net/blogs/fablefetchclip.gif?sp=r&st=2024-01-06T04:17:17Z&se=2050-01-06T12:17:17Z&spr=https&sv=2022-11-02&sr=b&sig=8KFjMliIEfjo7xqeE9DrL39MIJGk4PS2qATkdKaYB%2BQ%3D)\r\n\r\n[Fable.Fetch](https://github.com/fable-compiler/fable-fetch) is incredibly easy to use. Just remember that this example has no error handling.\r\n\r\nIn the repo I give another example using an `async` computation block instead of a `promise`  however the end result is the same. If you prefer not to pull in Fable.Promise package then using `async` work fine.\r\n\r\n## Feliz.UseDeferred\r\n\r\nLet's create a file called `FelizDeferred.fs` and install the required nuget package.\r\n\r\n```console\r\nfemto install Feliz.UseDeferred ./src\r\n```\r\n\r\nWe can re-use our domain model from previous however we will quickly pull out the logic to load users into its own module, this is 100% not required its just something i like to do.\r\n\r\n```fsharp\r\nmodule Domain\r\nopen Fable.Core\r\nopen Fetch\r\n\r\ntype User =\r\n  { id: int\r\n    first_name: string\r\n    last_name: string\r\n    email: string }\r\n\r\n[\u003cRequireQualifiedAccess>]\r\nmodule User =\r\n  //Required for useDeferred\r\n  let loadUsersAsync =\r\n    async {\r\n      let! response =\r\n        fetch \"https://random-data-api.com/api/v2/users?size=10\" []\r\n        |> Async.AwaitPromise\r\n\r\n      if response.Ok then\r\n        let! users = response.json\u003cUser list> () |> Async.AwaitPromise\r\n        return users\r\n      else\r\n        return []\r\n    }\r\n  //Required for out Fetch example\r\n  let loadUsers setUsers () =\r\n    promise {\r\n      let! response = fetch \"https://random-data-api.com/api/v2/users?size=10\" []\r\n\r\n      if response.Ok then\r\n        let! users = response.json\u003cUser list> ()\r\n        setUsers (users)\r\n    }\r\n    |> Promise.start\r\n```\r\n\r\nUpdate our `FetchData.fs` to use our new `loadUsers` function:\r\n\r\n```fsharp\r\nopen Domain\r\n\r\n[\u003cReactComponent>]\r\nlet FetchData () =\r\n  let (users, setUsers) = React.useState ([])\r\n  React.useEffect (User.loadUsers setUsers, [||])\r\n\r\n  ... \r\n```\r\n\r\nNow we can go back to our `FelizDeferred` component and finish it off:\r\n\r\n```fsharp\r\nmodule FelizDeferred\r\n\r\nopen Feliz\r\nopen Feliz.UseDeferred\r\nopen Feliz.DaisyUI\r\nopen Domain\r\n\r\nlet Spinner () =\r\n  Html.div [\r\n    prop.className \"absolute right-1/2 bottom-1/2  transform translate-x-1/2 translate-y-1/2\"\r\n    prop.children [\r\n      Daisy.loading [\r\n        loading.spinner\r\n        loading.lg\r\n      ]\r\n    ]\r\n  ]\r\n\r\nlet Error (message: string) =\r\n  Daisy.card [\r\n    card.bordered\r\n    prop.children [\r\n      Daisy.cardBody [\r\n        Daisy.cardTitle \"An error occurred!\"\r\n        Html.p message\r\n      ]\r\n    ]\r\n  ]\r\n\r\nlet UserCard (props: {| users: User list |}) =\r\n  Html.div [\r\n    for user in users do\r\n      Daisy.card [\r\n        card.bordered\r\n        prop.children [\r\n          Daisy.cardBody [\r\n            Daisy.cardTitle (sprintf \"%s %s\" user.first_name user.last_name)\r\n            Html.p user.email\r\n          ]\r\n        ]\r\n      ]\r\n  ]\r\n\r\n[\u003cReactComponent>]\r\nlet Deferred () =\r\n  let data = React.useDeferred (User.loadUsersAsync, [||])\r\n\r\n  match data with\r\n  | Deferred.HasNotStartedYet -> Html.none\r\n  | Deferred.InProgress -> Spinner()\r\n  | Deferred.Failed error -> Error error.Message\r\n  | Deferred.Resolved content -> UserCard {| users = content |}\r\n```\r\n\r\nAdd button to navigate in our `Home` component\r\n\r\n```fsharp\r\nDaisy.button.a [\r\n    prop.href \"/#feliz-deferred\"\r\n    prop.text \"Feliz.Deferred\"\r\n]\r\n```\r\n\r\nAnd update our router with our new page:\r\n\r\n```fsharp\r\n  [\u003cReactComponent>]\r\n  static member Router() =\r\n    let (currentUrl, updateUrl) = React.useState (Router.currentUrl ())\r\n\r\n    Html.div [\r\n      Components.NavBar()\r\n      React.router [\r\n        router.onUrlChanged updateUrl\r\n        router.children [\r\n          match currentUrl with\r\n          | [] -> Components.Home()\r\n          | [ \"elmish-converter\" ] -> ElmishConverter.TemperatureConverter()\r\n          | [ \"converter\" ] -> Converter.Converter()\r\n          | [ \"fable-fetch\" ] -> FableFetch.FetchData()\r\n          | [ \"feliz-deferred\" ] -> FelizDeferred.Deferred()\r\n          | otherwise -> Html.h1 \"Not found\"\r\n        ]\r\n      ]\r\n    ]\r\n```\r\n\r\nRun the app and check out the new page! It should render out exactly the same as out previous component.\r\n\r\nOne of my favorite parts of using this method for data fetching is it forces me to consider and handle all the loading states and tends to help give a better user experience. I typically break out most of the states into re-usable components, that way I ony need to implement the case where data has loaded successfully.\r\n\r\n## Summary\r\n\r\nHey there! In the latest chapter of our web development journey with F# using Feliz and Fable, we took a thrilling dive into the world of asynchronicity and data fetching. We explored how to make our web application come alive by reaching out to external services for fresh, dynamic data. I showed you two awesome methods for doing this: Fable.Fetch and React.useDeferred.\r\n\r\nWe started by setting sail with Fable.Fetch, installed the necessary packages, and created a nifty example to fetch random user data from an API. I walked you through creating a `loadUsers` async function wrapped in a `useEffect` hook to load the users once and populate our app's UI with the data received.\r\n\r\nThen, I introduced the magical world of React.useDeferred. We created a new component, separated our fetching logic, and managed to render similar output to our Fable.Fetch example, with beautiful loading state management right out of the box!\r\n\r\nBoth methods were super easy and fun to implement, adding that connectedness and richness to our F# web application. In our next post, we'll raise the stakes even higher as we learn how to wrap third-party components into our app. It's going to be fantastic, and I can't wait to show you how!\r\n\r\nStay tuned, and keep it upbeat, as our adventure only gets more exciting from here!\r\n"}},"urlPathname":"/blog/part-5-using-fetch-apis-in-fable","routeParams":{"pageTitle":"part-5-using-fetch-apis-in-fable"},"documentProps":{"title":"Part 5-Using Fetch APIs in Fable","description":"Explore data fetching in F# web apps using Feliz and Fable by integrating the Fetch API with promises and React hooks. Learn through a practical example that retrieves user data asynchronously, utilizing the Fable.Fetch library and the Feliz.UseDeferred hook for efficient and type-safe HTTP requests in a functional programming paradigm."},"abortReason":"!undefined","_urlRewrite":null,"_urlRedirect":"!undefined","abortStatusCode":"!undefined","_abortCall":"!undefined","_pageContextInitIsPassedToClient":"!undefined","_pageId":"/pages/blog/@pageTitle","data":"!undefined"}</script>
        <script src="/assets/entries/entry-server-routing.D_llxFIk.js" type="module" async></script>
        <link rel="modulepreload" href="/assets/entries/pages_blog_-pageTitle.qq6wV5wR.js" as="script" type="text/javascript">
        <link rel="modulepreload" href="/assets/chunks/chunk-lqWB3pjr.js" as="script" type="text/javascript">
        <link rel="modulepreload" href="/assets/chunks/chunk-IzzgPy2T.js" as="script" type="text/javascript">
      </body>
    </html>